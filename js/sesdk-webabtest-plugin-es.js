/**
 * sesdk-webabtest-plugin-es.prod.js
 * version: 1.3.0
 * LastModified: 3/14/2025 16:24:51 GMT+0800
 */
function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(r){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(t){e(r,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))}))}return r}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(e,t){return e(t={exports:{}},t.exports),t.exports}var i,u,s=function(e){return e&&e.Math===Math&&e},a=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof n&&n)||s("object"==typeof n&&n)||function(){return this}()||Function("return this")(),c={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},l="object"==typeof document&&document.all,f=void 0===l&&void 0!==l?function(e){return"function"==typeof e||e===l}:function(e){return"function"==typeof e},p=function(e){return"object"==typeof e?null!==e:f(e)},m=a.document,d=p(m)&&p(m.createElement),g=function(e){return d?m.createElement(e):{}},v=g("span").classList,y=v&&v.constructor&&v.constructor.prototype,b=y===Object.prototype?void 0:y,h=function(e){try{return!!e()}catch(e){return!0}},_=!h((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),T=Function.prototype,P=T.call,S=_&&T.bind.bind(P,P),O=_?S:function(e){return function(){return P.apply(e,arguments)}},k=O({}.toString),j=O("".slice),C=Object,I=O("".split),w=h((function(){return!C("z").propertyIsEnumerable(0)}))?function(e){return"String"===function(e){return j(k(e),8,-1)}(e)?I(e,""):C(e)}:C,E=function(e){return null==e},D=TypeError,R=function(e){if(E(e))throw new D("Can't call method on "+e);return e},L=function(e){return w(R(e))},A=Object.defineProperty,M=function(e,t){try{A(a,e,{value:t,configurable:!0,writable:!0})}catch(r){a[e]=t}return t},x=o((function(e){var t="__core-js_shared__",r=e.exports=a[t]||M(t,{});(r.versions||(r.versions=[])).push({version:"3.40.0",mode:"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.40.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),q=function(e,t){return x[e]||(x[e]=t||{})},N=Object,F=function(e){return N(R(e))},V=O({}.hasOwnProperty),G=Object.hasOwn||function(e,t){return V(F(e),t)},U=0,B=Math.random(),H=O(1..toString),z=function(e){return"Symbol("+(void 0===e?"":e)+")_"+H(++U+B,36)},K=a.navigator,W=K&&K.userAgent,$=W?String(W):"",Y=a.process,X=a.Deno,J=Y&&Y.versions||X&&X.version,Q=J&&J.v8;Q&&(u=(i=Q.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!u&&$&&(!(i=$.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=$.match(/Chrome\/(\d+)/))&&(u=+i[1]);var Z,ee=u,te=a.String,re=!!Object.getOwnPropertySymbols&&!h((function(){var e=Symbol("symbol detection");return!te(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ee&&ee<41})),ne=re&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,oe=a.Symbol,ie=q("wks"),ue=ne?oe.for||oe:oe&&oe.withoutSetter||z,se=function(e){return G(ie,e)||(ie[e]=re&&G(oe,e)?oe[e]:ue("Symbol."+e)),ie[e]},ae=String,ce=TypeError,le=function(e){if(p(e))return e;throw new ce(ae(e)+" is not an object")},fe=!h((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),pe=fe&&h((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),me=!fe&&!h((function(){return 7!==Object.defineProperty(g("div"),"a",{get:function(){return 7}}).a})),de=Function.prototype.call,ge=_?de.bind(de):function(){return de.apply(de,arguments)},ve=function(e,t){return arguments.length<2?(r=a[e],f(r)?r:void 0):a[e]&&a[e][t];var r},ye=O({}.isPrototypeOf),be=Object,he=ne?function(e){return"symbol"==typeof e}:function(e){var t=ve("Symbol");return f(t)&&ye(t.prototype,be(e))},_e=String,Te=TypeError,Pe=function(e){if(f(e))return e;throw new Te(function(e){try{return _e(e)}catch(e){return"Object"}}(e)+" is not a function")},Se=TypeError,Oe=TypeError,ke=se("toPrimitive"),je=function(e,t){if(!p(e)||he(e))return e;var r,n,o=(r=e[ke],E(r)?void 0:Pe(r));if(o){if(void 0===t&&(t="default"),n=ge(o,e,t),!p(n)||he(n))return n;throw new Oe("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var r,n;if("string"===t&&f(r=e.toString)&&!p(n=ge(r,e)))return n;if(f(r=e.valueOf)&&!p(n=ge(r,e)))return n;if("string"!==t&&f(r=e.toString)&&!p(n=ge(r,e)))return n;throw new Se("Can't convert object to primitive value")}(e,t)},Ce=function(e){var t=je(e,"string");return he(t)?t:t+""},Ie=TypeError,we=Object.defineProperty,Ee=Object.getOwnPropertyDescriptor,De="enumerable",Re="configurable",Le="writable",Ae={f:fe?pe?function(e,t,r){if(le(e),t=Ce(t),le(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Le in r&&!r[Le]){var n=Ee(e,t);n&&n[Le]&&(e[t]=r.value,r={configurable:Re in r?r[Re]:n[Re],enumerable:De in r?r[De]:n[De],writable:!1})}return we(e,t,r)}:we:function(e,t,r){if(le(e),t=Ce(t),le(r),me)try{return we(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new Ie("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},Me=Math.ceil,xe=Math.floor,qe=Math.trunc||function(e){var t=+e;return(t>0?xe:Me)(t)},Ne=function(e){var t=+e;return t!=t||0===t?0:qe(t)},Fe=Math.max,Ve=Math.min,Ge=Math.min,Ue=function(e){return t=e.length,(r=Ne(t))>0?Ge(r,9007199254740991):0;var t,r},Be=function(e){return function(t,r,n){var o=L(t),i=Ue(o);if(0===i)return!e&&-1;var u,s=function(e,t){var r=Ne(e);return r<0?Fe(r+t,0):Ve(r,t)}(n,i);if(e&&r!=r){for(;i>s;)if((u=o[s++])!=u)return!0}else for(;i>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},He={includes:Be(!0),indexOf:Be(!1)},ze={},Ke=He.indexOf,We=O([].push),$e=function(e,t){var r,n=L(e),o=0,i=[];for(r in n)!G(ze,r)&&G(n,r)&&We(i,r);for(;t.length>o;)G(n,r=t[o++])&&(~Ke(i,r)||We(i,r));return i},Ye=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xe=Object.keys||function(e){return $e(e,Ye)},Je=fe&&!pe?Object.defineProperties:function(e,t){le(e);for(var r,n=L(t),o=Xe(t),i=o.length,u=0;i>u;)Ae.f(e,r=o[u++],n[r]);return e},Qe={f:Je},Ze=ve("document","documentElement"),et=q("keys"),tt=function(e){return et[e]||(et[e]=z(e))},rt="prototype",nt="script",ot=tt("IE_PROTO"),it=function(){},ut=function(e){return"<"+nt+">"+e+"</"+nt+">"},st=function(e){e.write(ut("")),e.close();var t=e.parentWindow.Object;return e=null,t},at=function(){try{Z=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;at="undefined"!=typeof document?document.domain&&Z?st(Z):(t=g("iframe"),r="java"+nt+":",t.style.display="none",Ze.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(ut("document.F=Object")),e.close(),e.F):st(Z);for(var n=Ye.length;n--;)delete at[rt][Ye[n]];return at()};ze[ot]=!0;var ct=Object.create||function(e,t){var r;return null!==e?(it[rt]=le(e),r=new it,it[rt]=null,r[ot]=e):r=at(),void 0===t?r:Qe.f(r,t)},lt=Ae.f,ft=se("unscopables"),pt=Array.prototype;void 0===pt[ft]&&lt(pt,ft,{configurable:!0,value:ct(null)});var mt,dt,gt,vt=function(e){pt[ft][e]=!0},yt={},bt=a.WeakMap,ht=f(bt)&&/native code/.test(String(bt)),_t=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Tt=fe?function(e,t,r){return Ae.f(e,t,_t(1,r))}:function(e,t,r){return e[t]=r,e},Pt="Object already initialized",St=a.TypeError,Ot=a.WeakMap;if(ht||x.state){var kt=x.state||(x.state=new Ot);kt.get=kt.get,kt.has=kt.has,kt.set=kt.set,mt=function(e,t){if(kt.has(e))throw new St(Pt);return t.facade=e,kt.set(e,t),t},dt=function(e){return kt.get(e)||{}},gt=function(e){return kt.has(e)}}else{var jt=tt("state");ze[jt]=!0,mt=function(e,t){if(G(e,jt))throw new St(Pt);return t.facade=e,Tt(e,jt,t),t},dt=function(e){return G(e,jt)?e[jt]:{}},gt=function(e){return G(e,jt)}}var Ct={set:mt,get:dt,has:gt,enforce:function(e){return gt(e)?dt(e):mt(e,{})},getterFor:function(e){return function(t){var r;if(!p(t)||(r=dt(t)).type!==e)throw new St("Incompatible receiver, "+e+" required");return r}}},It={}.propertyIsEnumerable,wt=Object.getOwnPropertyDescriptor,Et={f:wt&&!It.call({1:2},1)?function(e){var t=wt(this,e);return!!t&&t.enumerable}:It},Dt=Object.getOwnPropertyDescriptor,Rt={f:fe?Dt:function(e,t){if(e=L(e),t=Ce(t),me)try{return Dt(e,t)}catch(e){}if(G(e,t))return _t(!ge(Et.f,e,t),e[t])}},Lt=Function.prototype,At=fe&&Object.getOwnPropertyDescriptor,Mt=G(Lt,"name"),xt={EXISTS:Mt,PROPER:Mt&&"something"===function(){}.name,CONFIGURABLE:Mt&&(!fe||fe&&At(Lt,"name").configurable)},qt=O(Function.toString);f(x.inspectSource)||(x.inspectSource=function(e){return qt(e)});var Nt,Ft,Vt,Gt=x.inspectSource,Ut=o((function(e){var t=xt.CONFIGURABLE,r=Ct.enforce,n=Ct.get,o=String,i=Object.defineProperty,u=O("".slice),s=O("".replace),a=O([].join),c=fe&&!h((function(){return 8!==i((function(){}),"length",{value:8}).length})),l=String(String).split("String"),p=e.exports=function(e,n,f){"Symbol("===u(o(n),0,7)&&(n="["+s(o(n),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),f&&f.getter&&(n="get "+n),f&&f.setter&&(n="set "+n),(!G(e,"name")||t&&e.name!==n)&&(fe?i(e,"name",{value:n,configurable:!0}):e.name=n),c&&f&&G(f,"arity")&&e.length!==f.arity&&i(e,"length",{value:f.arity});try{f&&G(f,"constructor")&&f.constructor?fe&&i(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var p=r(e);return G(p,"source")||(p.source=a(l,"string"==typeof n?n:"")),e};Function.prototype.toString=p((function(){return f(this)&&n(this).source||Gt(this)}),"toString")})),Bt=function(e,t,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:t;if(f(r)&&Ut(r,i,n),n.global)o?e[t]=r:M(t,r);else{try{n.unsafe?e[t]&&(o=!0):delete e[t]}catch(e){}o?e[t]=r:Ae.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},Ht=Ye.concat("length","prototype"),zt={f:Object.getOwnPropertyNames||function(e){return $e(e,Ht)}},Kt={f:Object.getOwnPropertySymbols},Wt=O([].concat),$t=ve("Reflect","ownKeys")||function(e){var t=zt.f(le(e)),r=Kt.f;return r?Wt(t,r(e)):t},Yt=function(e,t,r){for(var n=$t(t),o=Ae.f,i=Rt.f,u=0;u<n.length;u++){var s=n[u];G(e,s)||r&&G(r,s)||o(e,s,i(t,s))}},Xt=/#|\.prototype\./,Jt=function(e,t){var r=Zt[Qt(e)];return r===tr||r!==er&&(f(t)?h(t):!!t)},Qt=Jt.normalize=function(e){return String(e).replace(Xt,".").toLowerCase()},Zt=Jt.data={},er=Jt.NATIVE="N",tr=Jt.POLYFILL="P",rr=Jt,nr=Rt.f,or=!h((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),ir=tt("IE_PROTO"),ur=Object,sr=ur.prototype,ar=or?ur.getPrototypeOf:function(e){var t=F(e);if(G(t,ir))return t[ir];var r=t.constructor;return f(r)&&t instanceof r?r.prototype:t instanceof ur?sr:null},cr=se("iterator"),lr=!1;[].keys&&("next"in(Vt=[].keys())?(Ft=ar(ar(Vt)))!==Object.prototype&&(Nt=Ft):lr=!0),(!p(Nt)||h((function(){var e={};return Nt[cr].call(e)!==e})))&&(Nt={}),f(Nt[cr])||Bt(Nt,cr,(function(){return this}));var fr={IteratorPrototype:Nt,BUGGY_SAFARI_ITERATORS:lr},pr=Ae.f,mr=se("toStringTag"),dr=function(e,t,r){e&&!r&&(e=e.prototype),e&&!G(e,mr)&&pr(e,mr,{configurable:!0,value:t})},gr=fr.IteratorPrototype,vr=function(){return this},yr=String,br=TypeError,hr=function(e){if(function(e){return p(e)||null===e}(e))return e;throw new br("Can't set "+yr(e)+" as a prototype")},_r=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=function(e,t,r){try{return O(Pe(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return R(r),hr(n),p(r)?(t?e(r,n):r.__proto__=n,r):r}}():void 0),Tr=xt.PROPER,Pr=xt.CONFIGURABLE,Sr=fr.IteratorPrototype,Or=fr.BUGGY_SAFARI_ITERATORS,kr=se("iterator"),jr="keys",Cr="values",Ir="entries",wr=function(){return this},Er=function(e,t){return{value:e,done:t}},Dr=Ae.f,Rr="Array Iterator",Lr=Ct.set,Ar=Ct.getterFor(Rr),Mr=function(e,t,r,n,o,i,u){!function(e,t,r,n){var o=t+" Iterator";e.prototype=ct(gr,{next:_t(+!n,r)}),dr(e,o,!1),yt[o]=vr}(r,t,n);var s,c,l,p=function(e){if(e===o&&y)return y;if(!Or&&e&&e in g)return g[e];switch(e){case jr:case Cr:case Ir:return function(){return new r(this,e)}}return function(){return new r(this)}},m=t+" Iterator",d=!1,g=e.prototype,v=g[kr]||g["@@iterator"]||o&&g[o],y=!Or&&v||p(o),b="Array"===t&&g.entries||v;if(b&&(s=ar(b.call(new e)))!==Object.prototype&&s.next&&(ar(s)!==Sr&&(_r?_r(s,Sr):f(s[kr])||Bt(s,kr,wr)),dr(s,m,!0)),Tr&&o===Cr&&v&&v.name!==Cr&&(Pr?Tt(g,"name",Cr):(d=!0,y=function(){return ge(v,this)})),o)if(c={values:p(Cr),keys:i?y:p(jr),entries:p(Ir)},u)for(l in c)(Or||d||!(l in g))&&Bt(g,l,c[l]);else!function(e,t){var r,n,o,i,u,s=e.target,c=e.global,l=e.stat;if(r=c?a:l?a[s]||M(s,{}):a[s]&&a[s].prototype)for(n in t){if(i=t[n],o=e.dontCallGetSet?(u=nr(r,n))&&u.value:r[n],!rr(c?n:s+(l?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Yt(i,o)}(e.sham||o&&o.sham)&&Tt(i,"sham",!0),Bt(r,n,i,e)}}({target:t,proto:!0,forced:Or||d},c);return g[kr]!==y&&Bt(g,kr,y,{name:o}),yt[t]=y,c}(Array,"Array",(function(e,t){Lr(this,{type:Rr,target:L(e),index:0,kind:t})}),(function(){var e=Ar(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,Er(void 0,!0);switch(e.kind){case"keys":return Er(r,!1);case"values":return Er(t[r],!1)}return Er([r,t[r]],!1)}),"values"),xr=yt.Arguments=yt.Array;if(vt("keys"),vt("values"),vt("entries"),fe&&"values"!==xr.name)try{Dr(xr,"name",{value:"values"})}catch(e){}var qr=se("iterator"),Nr=Mr.values,Fr=function(e,t){if(e){if(e[qr]!==Nr)try{Tt(e,qr,Nr)}catch(t){e[qr]=Nr}if(dr(e,t,!0),c[t])for(var r in Mr)if(e[r]!==Mr[r])try{Tt(e,r,Mr[r])}catch(t){e[r]=Mr[r]}}};for(var Vr in c)Fr(a[Vr]&&a[Vr].prototype,Vr);function Gr(e,t,r){e.setStateData({["reportData.properties.".concat(t)]:r})}Fr(b,"DOMTokenList");const Ur=["customIDProperties","customIDEventProperties","customIDUserProperties"];function Br(e,t){const r={};return Ur.forEach((n=>{e.isObject(t[n])&&(r[n]=e.filterCustomProperties(t[n]))})),r}function Hr(e,t){return e.isValueExceedLimit(e.valueToStr(t))?(t.shift(),Hr(e.config)):t}function zr(e,t,r,n,o){e.Storage.setItem(t,r.slice(n[o]),(()=>{o<n.length-1?zr(e,t,r,n,o+1):e.Storage.deleteItem(storageKey.combinationId)}))}function Kr(e,t,r,n){if(!Array.isArray(r))return[];const o=Hr(e,r.slice(0)),i=function(e,t){const r=e-t,n=[],o=Math.ceil(r/10);if(r>0)for(let e=r;e>0;e-=o)n.unshift(e);return n.unshift(0),n}(o.length,n);zr(e,t,o,i,0)}function Wr(e,t){const r=e.filter((e=>e.name===t));var n,o,i,u,s,a,c;return r.length?{value:null===(n=r[0])||void 0===n?void 0:n.value,groupId:null===(o=r[0])||void 0===o?void 0:o.group_id,status:null===(i=r[0])||void 0===i?void 0:i.status,from:null===(u=r[0])||void 0===u?void 0:u.from,entityId:null===(s=r[0])||void 0===s?void 0:s.entity_id,subjectName:null===(a=r[0])||void 0===a?void 0:a.subject_name,subjectValue:null===(c=r[0])||void 0===c?void 0:c.subject_value}:null}function $r(e,t){const r=e.getStateData("reportData");if(r._appkey&&t.subjectName&&t.subjectValue&&t.entityId&&t.groupId){const n="".concat(r._appkey,"_").concat(t.subjectName,"_").concat(t.subjectValue,"_").concat(t.entityId,"_").concat(t.groupId);if(e.Storage.getItem(n))return!0;e.Storage.setItem(n,1)}return!1}function Yr(e,t){const r=e.Storage.getItem(t,!0,[]);Gr(e,t,null!=r&&r.length?r:null)}function Xr(e,t,r){const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!Array.isArray(e))return[];const r=e.filter((e=>e.from===t)).map((e=>e.entity_id));return Array.from(new Set(r))}(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);Gr(e,r,n),e.Storage.setItem(r,n)}function Jr(e,t,r){e.t3=+new Date,e.param_value=t&&void 0!==t.value?t.value:null;let n=0;if("number"==typeof(null==t?void 0:t.param_from)&&(n=t.param_from),3!==n){var o;(null==r||null===(o=r.filter((t=>t.name===e.param_key)))||void 0===o?void 0:o.length)&&(n=1)}return e.param_from=n,e}function Qr(e,t,r){const{t0:n,t1:o,t2:i,t3:u,param_key:s,param_value:a,param_from:c}=t,l={message:"在线参数请求数据",state:1,api_total_duration:u-n,retry_count:-1,param_key:s,param_value:a,param_from:c};if(r){const{code:e,msg:t,retryCount:s}=r||{};l.code=e,l.error_message=t,l.retry_count=s,l.builld_request_body_duration=o-n,l.api_request_duration=i-o,l.data_process_duration=u-i}e.trackLogEvent(l)}const Zr={intervalTimer:null,mergeType:0,idProperties:{},defaultConfig:[],serverConfig:[],currentServerConfig:[],combinationId:"",eventProperties:{},userProperties:{},customRequestTimeout:0},en="_default_config",tn="_serevr_config",rn="_combination_id",nn="_group_id_list",on="_experiment_group_id_list",un="_experiment_history";function sn(e,t,r){const{t0:n,t1:o}=t,{code:i,msg:u,retryCount:s}=r||{},a={message:"多链接试验请求数据",state:5,code:i,error_message:u,retry_count:s,api_request_duration:o-n};e.trackLogEvent(a)}var an={addMask(e){var t;const r="body{opacity:0 !important;-khtml-opacity:0 !important;-moz-opacity:0;filter:alpha(opacity=0);}",n=document.createElement("style");n.type="text/css";try{n.appendChild(document.createTextNode(r))}catch(e){n.styleSheet.cssText=r}this.styleElement=n,null===(t=document.getElementsByTagName("head"))||void 0===t||null===(t=t[0])||void 0===t||t.appendChild(n),this.removeMaskTimer=setTimeout((()=>{this.removeMask()}),1e3*e)},removeMask(){var e;(clearTimeout(this.removeMaskTimer),this.styleElement)&&(null===(e=document.getElementsByTagName("head"))||void 0===e||null===(e=e[0])||void 0===e||e.removeChild(this.styleElement),this.styleElement=null)}};const cn={idProperties:{},serverConfig:[],eventProperties:{},userProperties:{},customRequestTimeout:0},ln={multilinkHistory:"_multilink_history"+location.pathname};var fn={env:0,version:"1.3.0",init(e){if(null==e||!e.NATIVE||"function"!=typeof(null==e?void 0:e.extend))return console.error("SESDK Error: Plugin can not be used alone, you need to rely on the webSDK");!function(e){e.extend({abtest:{init(t){Zr.mergeType=t.mergeType||0,Zr.idProperties=Br(e,t),Zr.defaultConfig=e.Storage.getItem(en,!0,[]),"number"==typeof t.requestTimeout&&t.requestTimeout>0&&(Zr.customRequestTimeout=t.requestTimeout),this.checkCacheConfig(),this.initReportData(),this.getOnlineConfig(!0)},initReportData(){Gr(e,rn,e.Storage.getItem(rn)||null),Yr(e,nn),Yr(e,on),Gr(e,"_custom_id",Zr.idProperties.customIDProperties),Gr(e,"_event_custom_id",Zr.idProperties.customIDEventProperties),Gr(e,"_user_custom_id",Zr.idProperties.customIDUserProperties)},checkCacheConfig(){var t;Zr.combinationId=e.Storage.getItem(rn)||"",Zr.serverConfig=e.Storage.getItem(tn,!0,[]),!Zr.combinationId||null!==(t=Zr.serverConfig)&&void 0!==t&&t.length||(Zr.combinationId="",e.Storage.deleteItem(rn))},getOnlineConfig:function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.checkCacheConfig();const o=e.deepCopy(e.getStateData("reportData")||{}),i=e.getStateData("pluginProperties"),u=e.deepCopy(o.properties);delete o.properties,delete o._package_type;const s=r(r(r({},o),u),{},{_combination_id:t&&1===Zr.mergeType?"":Zr.combinationId,event_properties:r({},Zr.eventProperties),user_properties:r({},Zr.userProperties),_custom_id:Zr.idProperties.customIDProperties,_event_custom_id:Zr.idProperties.customIDEventProperties,_user_custom_id:Zr.idProperties.customIDUserProperties,experiment_history:e.Storage.getItem(un,!0,[])});return i._sub_lib_version&&(s._sub_lib_version=i._sub_lib_version),n.t1=+new Date,new Promise((e=>{this.requestRetry(e,s,t,n)}))},requestRetry(t,r,n,o){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.settingData.ruleRetryTimes;e.HttpHelper.post("//".concat(e.settingData.ruleDomain,"/rule/config/get"),r,{timeout:Zr.customRequestTimeout||1e3*e.settingData.ruleTimeout}).then((e=>{o.t2=+new Date,0===(null==e?void 0:e.code)&&this.handleServerConfig((null==e?void 0:e.data)||{},n),t({retryCount:3-i,code:null==e?void 0:e.code,msg:null==e?void 0:e.msg}),this.setTimer()})).catch((u=>{i>0&&!Zr.customRequestTimeout?(i--,this.requestRetry(t,r,n,o,i)):(this.setTimer(),t({retryCount:e.settingData.ruleRetryTimes-i,code:(null==u?void 0:u.code)||"timeout",msg:(null==u?void 0:u.msg)||u}))}))},setTimer(){clearTimeout(Zr.intervalTimer),Zr.intervalTimer=setTimeout((()=>this.getOnlineConfig()),1e3*e.settingData.ruleInterval)},handleServerConfig(t,r){var n;let o=t.params||[];const i=null==t?void 0:t._combination_id,u=(null===(n=o)||void 0===n?void 0:n.length)||0;Zr.currentServerConfig=o,i&&(Zr.combinationId=i,e.Storage.setItem(rn,i),Gr(e,rn,i)),i&&u&&(Xr(e,o,nn),Xr(e,o,on,2),e.Storage.setItem(un,o.filter((e=>2===e.from)).map((e=>({entity_id:e.entity_id,group_id:e.group_id})))),0!==Zr.mergeType&&r||(o=function(e,t){return null!=t&&t.length?t.filter((t=>e.findIndex((e=>e.name===t.name))<0)).concat(e):e}(o,Zr.serverConfig)),Zr.serverConfig=o,Kr(e,tn,o,u))},getConfigByKey(t){let r=Wr(Zr.serverConfig,t);return null===r?(r=Wr(Zr.defaultConfig,t),e.isObject(r)&&(r.param_from=3)):r.param_from=2,r},trackTriageEvents(t){if(!$r(e,t))if(1===t.from){const r={_enter_group_id:t.entityId,_enter_group_status:t.status};e.trackEvent("_diversion_service",r,{},{_event_type:2})}else{const r={_experiment_id:t.groupId,_experiment_group_id:t.entityId,_experiment_status:t.status};e.trackEvent("_abtesting_shunt",r,{},{_event_type:2})}}}})}(e),function(e){e.NATIVE=Object.assign(e.NATIVE,{setRemoteDefaultConfig(t){if(e.checkLogEnabled("setRemoteDefaultConfig",t),!Array.isArray(t))return e.assert(!1,440103);Zr.defaultConfig=t,e.Storage.setItem(en,t)},setRemoteConfigEventProperties(t){e.checkLogEnabled("setRemoteConfigEventProperties",t),e.checkObject(t)&&(Zr.eventProperties=Object.assign(Zr.eventProperties,t))},setRemoteConfigUserProperties(t){e.checkLogEnabled("setRemoteConfigUserProperties",t),e.checkObject(t)&&(Zr.userProperties=Object.assign(Zr.userProperties,t))},fastFetchRemoteConfig(t){if(e.checkLogEnabled("fastFetchRemoteConfig",t),!t||"string"!=typeof t||!e.trimStr(t))return e.assert(!1,440105);const r={t0:+new Date,param_key:t},n=e.abtest.getConfigByKey(t);let o=null;return n&&void 0!==n.value&&(n.groupId&&e.abtest.trackTriageEvents(n),o=n.value),Qr(e,Jr(r,n,Zr.currentServerConfig)),o},asyncFetchRemoteConfig(t){if(e.checkLogEnabled("asyncFetchRemoteConfig",t),!t||"string"!=typeof t||!e.trimStr(t))return e.assert(!1,440105);const r={t0:+new Date,param_key:t};return new Promise((n=>{e.NATIVE.ready((()=>{e.abtest.getOnlineConfig(!1,r).then((o=>{const i=e.abtest.getConfigByKey(t);let u=null;i&&void 0!==i.value&&(i.groupId&&e.abtest.trackTriageEvents(i),u=i.value),n(u),Qr(e,Jr(r,i,Zr.currentServerConfig),o)}))}))}))}})}(e),function(e){e.extend({multilinkTest:{runtime:!0,init(t){this.initRemoteConfig(t),cn.idProperties=Br(e,t),this.initReportData(),this.getOnlineConfig()},initRemoteConfig(t){cn.maskTimeoutCloseTime=e.settingData.maskTimeoutCloseTime,"number"==typeof t.requestTimeout&&t.requestTimeout>0&&(cn.customRequestTimeout=t.requestTimeout),"number"==typeof(null==t?void 0:t.maskTimeoutCloseTime)&&t.maskTimeoutCloseTime/1e3>e.settingData.minMaskTimeoutCloseTime&&(cn.maskTimeoutCloseTime=t.maskTimeoutCloseTime/1e3),null!=t&&t.isSetMask&&an.addMask(cn.maskTimeoutCloseTime)},initReportData(){Gr(e,"_custom_id",cn.idProperties.customIDProperties),Gr(e,"_event_custom_id",cn.idProperties.customIDEventProperties),Gr(e,"_user_custom_id",cn.idProperties.customIDUserProperties)},getOnlineConfig:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=e.deepCopy(e.getStateData("reportData")||{}),o=e.deepCopy(n.properties);delete n.properties,delete n._package_type,delete o._combination_id,delete o._experiment_group_id_list,delete o._group_id_list;const i=r(r(r({},n),o),{},{event_properties:r({},cn.eventProperties),user_properties:r({},cn.userProperties),_custom_id:cn.idProperties.customIDProperties,_event_custom_id:cn.idProperties.customIDEventProperties,_user_custom_id:cn.idProperties.customIDUserProperties,experiment_history:e.Storage.getItem(ln.multilinkHistory,!0,[])});return t.t0=+new Date,new Promise((e=>{this.requestRetry(e,i,t)}))},requestRetry(t,r,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.settingData.multilinkRetryTimes;e.HttpHelper.post("//".concat(e.settingData.ruleDomain,"/rule/config/multilink/get"),r,{timeout:cn.customRequestTimeout||1e3*e.settingData.multilinkTimeout}).then((t=>{n.t1=+new Date,0===(null==t?void 0:t.code)&&this.handleServerConfig((null==t?void 0:t.data)||{}),an.removeMask();const r={retryCount:3-o,code:null==t?void 0:t.code,msg:null==t?void 0:t.msg};sn(e,n,r)})).catch((i=>{if(o>0&&!cn.customRequestTimeout)o--,this.requestRetry(t,r,n,o);else{n.t1=+new Date,an.removeMask(),e.customEvents.$emit("multilinkTestResponse");const t={retryCount:e.settingData.multilinkRetryTimes-o,code:(null==i?void 0:i.code)||"timeout",msg:(null==i?void 0:i.msg)||i};sn(e,n,t)}}))},handleServerConfig(t){var r,n,o,i,u,s,a;const c=t.params||[],l=e.trimStr((null===(r=c[0])||void 0===r?void 0:r.url)||"");if(null==c||!c.length||!l)return void e.customEvents.$emit("multilinkTestResponse");const f={url:l,subjectId:null===(n=c[0])||void 0===n?void 0:n.subject_id,entityId:null===(o=c[0])||void 0===o?void 0:o.entity_id,groupId:null===(i=c[0])||void 0===i?void 0:i.group_id,status:null===(u=c[0])||void 0===u?void 0:u.status,subjectName:null===(s=c[0])||void 0===s?void 0:s.subject_name,subjectValue:null===(a=c[0])||void 0===a?void 0:a.subject_value},p=$r(e,f);p||this.trackTriageEvents(f);const m=l===location.href;m&&e.customEvents.$emit("multilinkTestResponse"),e.Storage.setItem(ln.multilinkHistory,c.map((e=>({entity_id:e.entity_id,group_id:e.group_id})))),m||setTimeout((()=>{location.href=f.url}),p?0:1e3*e.settingData.multilinkJumpWaitSendEvent)},trackTriageEvents(t){const r={_experiment_id:t.groupId,_experiment_group_id:t.entityId,_experiment_status:t.status};e.trackEvent("_abtesting_shunt",r,{},{_event_type:2})}}})}(e),function(e){e.NATIVE=Object.assign(e.NATIVE,{setMultilinkTestEventProperties(t){e.checkLogEnabled("setMultilinkTestEventProperties",t),e.checkObject(t)&&(cn.eventProperties=Object.assign(cn.eventProperties,t))},setMultilinkTestUserProperties(t){e.checkLogEnabled("setMultilinkTestUserProperties",t),e.checkObject(t)&&(cn.userProperties=Object.assign(cn.userProperties,t))}})}(e)}};export{fn as default};
